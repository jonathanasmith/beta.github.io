<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/site.webmanifest">
  <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <title>Home</title>
  <link href="css/default.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>
<body>
  <header class="B_i">
    <div class="FR" style="height:150px;max-width:900px;margin:auto">
      <div class="F_1 flexCell_v"></div>
      <div class="F_1 flexCell_v"><img src="images/logo_white.png" class="H_50"/></div>
      <div id="cartIcon" class="F_1 h3 flexCell_v " onclick="launchCart()"><i class="fas fa-shopping-cart hide"></i></div>
    </div>
  </header>

<!-- Start of Main content ******************************************************************************** -->

  <div class="flexCell_v">
    <div style="max-width:800px;margin:auto">

      <span id="deleteNotice"></span>

      <!-- Connect ******************************************************************************** -->

      <div id="connect" class="flexCell_v hide">
        <div class="M_L_50 M_R_50 FC">
          <div class="H_50"></div>
          <div class="F_1 h3 TA_C">We make gear you unlock by running. Connect with Strava below to get started (or to log back in)</div>
          <div class="H_20"></div>
          <div class="F_1 TA_C">
            <a href="https://www.strava.com/oauth/authorize?client_id=7316&response_type=code&redirect_uri=https://api.kick.run/beta&approval_prompt=force&scope=view_private,write">
              <img src="images/btn_strava_connectwith_orange@2x.png" class="active H_50"/>
            </a>
            <div class="H_20"></div>
          </div>
        </div>
        <div class="H_20"></div>
        <div id="demo" class="FR fade">
          <div id="demoContent" class="F_1 behind productContainer">
            <div class="BI_iv H_10 M_L_20 M_R_20"></div>
            <div class="H_30"></div>
            <div class="FR ">
              <div class="F_1 collapse FR">
                <div class="F_1 flexCell_v">
                  <img src="images/top1.png" class="productImage"/>
                </div>
                <div class="H_20"></div>
                <div class="F_1 flexCell_v">
                  <img src="images/top2.png" class="productImage"/>
                </div>
              </div>
              <div class="F_1 collapse FR ">
                <div class="F_1 flexCell_v">
                  <img src="images/top3.png" class="productImage"/>
                </div>
                <div class="H_20"></div>
                <div class="F_1 flexCell_v">
                  <img src="images/top4.png" class="productImage"/>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--Connect Block-->


      <!--Loading Block-->
      <div id="loading" class="flexCell_v">
        <div class="H_150"></div>
        <img src="https://cdn.shopify.com/s/files/1/1368/7687/files/Spinner.gif?1196196044267427305" class="H_75">
        <div class="H40"></div>
        <div id="settingUp" class="h3 textAlign_center">Getting set up...</div>
        <div id="activityHistory" style="display:none" class="h3 M_L_20 M_R_20 TA_C">Welcome, <span id="firstNameConnecting"></span>, bear with us, we're just checking out your past activities.</div>
      </div>

      <!--Loading Block-->

      <!--Connected Block-->
      <div class="H_50"></div>
      <div id="connected" class="hide">
      <div class="flexCell_v" id="connected">
        <div class="h3 TA_C M_L_50 M_R_50 LH_15">ðŸ‘‹ Hi, <span id="firstName"></span>, welcome to Kick.run! Check out your tops and challenges below</div>
      </div>

      <!--Unlockable Products-->

      <!--Product Block 1-->
      <div class="H_50"></div>
      <div class="h3 FR AI_C JC_C M_L_20 M_R_20 M_B_10">
        <div class="F_10 ">Have you run the distance?</div>
      </div>
      <div class="H20"></div>
      <div class="BI_iii H_10 M_L_20 M_R_20"></div>
      <div class="H_50"></div>
      <div class="FR">
        <div class="F_1 collapse FR">
          <div class="F_1 flexCell_v">
            <img src="images/top1.png" class="productImage"/>
            <div class="H_20"></div>
            <button class="Bu_i active disable B_i" value="5k" onclick="productFlow(this.id)" id="top1">
              <i class="fas fa-lock" id="topUnlock1"></i>&nbsp;&nbsp;5k
            </button>
            <div class="H_50"></div>
          </div>
          <div class="F_1 flexCell_v">
            <img src="images/top2.png" class="productImage"/>
            <div class="H_20"></div>
            <button class="Bu_i active disable B_i" onclick="productFlow(this.id)" id="top2">
              <i class="fas fa-lock" id="topUnlock2"></i>&nbsp;&nbsp;10k
            </button>
            <div class="H_50"></div>
          </div>
        </div>
        <div class="F_1 collapse FR ">
          <div class="F_1 flexCell_v">
            <img src="images/top3.png" class="productImage"/>
            <div class="H_20"></div>
            <button class="Bu_i active disable B_i" onclick="productFlow(this.id)" id="top3">
              <i class="fas fa-lock" id="topUnlock3"></i>&nbsp;&nbsp;Half Marathon
            </button>
            <div class="H_50"></div>
          </div>
          <div class="F_1 flexCell_v">
            <img src="images/top4.png" class="productImage"/>
            <div class="H_20"></div>
            <button class="Bu_i active disable B_i" onclick="productFlow(this.id)" id="top4">
              <i class="fas fa-lock" id="topUnlock4"></i>&nbsp;&nbsp;Marathon
            </button>
            <div class="H_50"></div>
          </div>
        </div>
      </div>
      <!--Product Block 1-->

        <!--Product Block 2-->

        <!--Unlock Products-->

      <div class="H_50"></div>
      <div class="BI_iii H_10 M_L_20 M_R_20"></div>
      <div class="H_20"></div>
      <div class="p3 M_L_20 M_R_20 LH_25">
        <span class="FW_600">Account Settings:</span> 
        Your account is connected to Strava <button class="active Bu_ii BS B_iv" onclick="disconnect()"><i class="fas fa-unlink"></i>&nbsp;&nbsp;Disconnect</button> 

        <span id="notifications1" style="display:none">Unlock notifications are on <button class="active Bu_ii BS B_i" onclick="notificationsOff()"><i class="fas fa-bell"></i>&nbsp;&nbsp;Turn off</button></span>

        <span id="notifications2" style="display:none">Unlock notifications are off <button class="active Bu_ii BS B_i" onclick="notificationsOn()"><i class="fas fa-bell"></i>&nbsp;&nbsp;Turn on</button></span>

        <span id="preferences1" style="display:none">You are receiving updates and offers from Kick.run <button class="active Bu_ii BS B_i" onclick="preferencesOff()"><i class="fas fa-bullhorn"></i>&nbsp;&nbsp;Stop updates</button></span>

        <span id="preferences2" style="display:none">You are not receiving updates and offers from Kick.run <button class="active Bu_ii BS B_i" onclick="preferencesOn()"><i class="fas fa-bullhorn"></i>&nbsp;&nbsp;Receive updates</button></span>

        Any other queries? Just <button class="active Bu_ii BS B_i" onclick="location.href='mailto:hello@kick.run';"><i class="fas fa-envelope"></i>&nbsp;&nbsp;Get in touch</button>

      </div>

      <div class="H_50"></div>
      </div>

      <!-- Gender ******************************************************************************** -->

      <div id="buyOne" class="hide">
        <div class="FR M_A JC_C H_75 AI_C" style="max-width:600px;,">
          <div class="F_025"></div>
          <div class="F_1 B_i progress" id="progressOne"></div>
          <div class="F_1 progress" id="progressTwo"></div>
          <div class="F_1 progress" id="progressThree"></div>
          <div class="F_1 progress" id="progressFour"></div>
          <div class="F_025"></div>
        </div>
        <div class="h3 TA_C M_L_20 M_R_20" >
          Mens or womens?
        </div>
        <div class="H_20"></div>
        <div class="TA_C h4 M_L_20 M_R_20">
          Would you prefer a mens or womens fit? 
        </div>
        <div class="H_50"></div>
        <div class="FR">
          <div class="F_1 flexCell_vi M_R_20" onclick="storeLocal('G','M'); hideShowBlock('buyOne','buyTwo')">
            <div class="productBackground flexCell_v FoC_i h2 FW_500 active" style="background-image:url('images/top1.png')">
            </div>
            <div class="H_20"></div>
            <button class="Bu_i active B_i">Mens</button>
          </div>

          <div class="F_1 flexCell_iv M_L_20" onclick="storeLocal('G','F'); hideShowBlock('buyOne','buyTwo')">
            <div class="productBackground flexCell_v FoC_i h2 FW_500 active" onclick="storeLocal('G','F'); hideShowBlock('buyOne','buyTwo')" style="background-image:url('images/top2.png')">
            </div>
            <div class="H_20"></div>
            <button class="Bu_i active B_i">Womens</button>
          </div>
        </div>
      </div>

      <!-- Material ******************************************************************************** -->

      <div id="buyTwo" class="hide">
        <div class="FR M_A JC_C H_75 AI_C" style="max-width:600px;,">
          <div class="F_025"></div>
          <div class="F_1 B_i progress" id="progressOne"></div>
          <div class="F_1 B_i progress" id="progressTwo"></div>
          <div class="F_1 progress" id="progressThree"></div>
          <div class="F_1 progress" id="progressFour"></div>
          <div class="F_025"></div>
        </div>
        <div class="h3 TA_C M_L_20 M_R_20" >  
          T-shirt or Technical?
        </div>
        <div class="H_20"></div>
        <div class="TA_C h4 M_L_20 M_R_20">
          Our 100% polyester TriDri technical tops are ideal for working up a bit of a sweat whilst our 100% ringspun cotton is perfect for relaxing with a post race beer!
        </div>
        <div class="H_50"></div>
        <div class="FR">
          <div class="F_1 flexCell_vi M_R_20" onclick="storeLocal('G','M'); hideShowBlock('buyOne','buyTwo')">
            <div class="productBackground flexCell_v FoC_i h2 FW_500 active" style="background-image:url('images/top2.png')">
            </div>
            <div class="H_20"></div>
            <button class="Bu_i active B_i">T-shirt</button>
          </div>
          <div class="F_1 flexCell_iv M_L_20" onclick="storeLocal('G','F'); hideShowBlock('buyOne','buyTwo')">
            <div class="productBackground flexCell_v FoC_i h2 FW_500 active" onclick="storeLocal('G','F'); hideShowBlock('buyOne','buyTwo')" style="background-image:url('images/top1.png')">
            </div>
            <div class="H_20"></div>
            <button class="Bu_i active B_i">Womens</button>
          </div>
        </div>
      </div>

      <!-- Size ******************************************************************************** -->

      <div id="buyThree" class="hide">
        <div class="FR M_A JC_C H_75 AI_C" style="max-width:600px;">
          <div class="F_025"></div>
          <div class="F_1 B_i progress" id="progressOne"></div>
          <div class="F_1 B_i progress" id="progressTwo"></div>
          <div class="F_1 B_i progress" id="progressThree"></div>
          <div class="F_1 progress" id="progressFour"></div>
          <div class="F_025"></div>
        </div>

        <div class="h3 TA_C M_L_20 M_R_20" >
          Choose your size
        </div>
        <div class="H_20"></div>
        <div class="flexCell_v"><div>Womens sizes</div></div>
        <div class="FR M_A JC_C H_75 AI_C" style="max-width:600px;">
          <div class="F_025"></div>
          <div class="F_1 size B_i flexCell_v h4 active link" onclick="storeLocal('S','S'); hideShowBlock('buyThree','cart')" id="progressOne">
            <div>S</div>
          </div>
          <div class="F_1 size B_i flexCell_v h4 active link" id="progressOne">
            <div>M</div>
          </div>
          <div class="F_1 size B_i flexCell_v h4 active link" id="progressOne">
            <div>L</div>
          </div>
          <div class="F_1 size B_i flexCell_v h4 active link" id="progressOne">
            <div>XL</div>
          </div>
          <div class="F_1 size B_i flexCell_v h4 active link" id="progressOne">
            <div>XXL</div>
          </div>
          <div class="F_025"></div>
        </div>
        <div class="H_30"></div>
        <div class="FR flexCell_v">
          <div id='product-component-af794437882'></div>        
        </div>
      </div>

      <!-- Cart ******************************************************************************** -->

      <div id="cart" class="hide">
        <div class="H_40"></div>
        <div class="h1 TA_C M_L_10 M_R_10" >
          <i class="fas fa-shopping-cart"></i> Cart 
        </div>
        <div class="H_20"></div>
        <div class="BI_iv H_10 M_L_20 M_R_20"></div>
        <div class="H_30"></div>
        <span id="cartContents"></span> 
        <div class="H_20"></div>
        <div class="flexCell_v hide" id="fullCart">
          <button class="Bu_i active B_i">Checkout</button>
          <div class="H_20"></div>
          <div class="active" onclick="exitCart()">Continue shopping</div>
        </div>
        <div class="flexCell_v hide" id="emptyCart">

          <div class="active Bu_ii BS B_i flexCell_v P_L_10 P_R_10"  onclick="exitCart()">Continue shopping</div>
        </div>
      </div>

    </div>
  </div>

  <footer class="F_1 B_i FR H_75">
    <div class="footerContainer FR H_75 ">
      <div class="F_1 flexCell_iv M_L_20">&copy; Runwithkick Limited 2018</div>
      <div class="F_1 flexCell_v">
      </div>
      <div class="F_1 FR AI_C JC_E h2 P_R_20">
        <a href="https://facebook.com/groups/runwithkick" class="noStyle" target="_blank"><i class="fab fa-facebook-square"></i></a>&nbsp;&nbsp;
        <a href="https://twitter.com/runwithkick" class="noStyle" target="_blank"><i class="fab fa-twitter-square"></i></a>&nbsp;&nbsp;
        <a href="https://instagram.com/runwithkick" class="noStyle" target="_blank"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
  </footer>
</body>
</html>

<script src="https://npmcdn.com/parse@1.11.1/dist/parse.js"></script>
<script src="JS/main.js"></script>

<script>

var accessTokenURL = getQueryVariable("accesstoken")
var accessTokenCookie = getCookie("accesstoken")

if(accessTokenCookie.length>0){

storeLocal('accessToken',accessTokenCookie);
//var accessToken = accessTokenCookie

startParse();

Parse.Cloud.run('retrieveUser', {
  AccessToken: accessTokenCookie
  }, {
  success: function(result) {

    if (result.activeUser == false) {
      document.getElementById("deleteNotice").innerHTML = '<div onclick="reconnect()" class="active FR H_50 flexCell_v TA_C B_iv BoR_10_B">Your account has been queued for deletion. <span class="FW_500">Please click here to undo this action.</span></div>'
    }

    document.getElementById("firstNameConnecting").innerHTML = result.tokenResponse.athlete.firstname
    document.getElementById("firstName").innerHTML = result.tokenResponse.athlete.firstname
    
    if (result.firstSweep == false){

      document.getElementById('settingUp').style.display = "none";
      document.getElementById('activityHistory').style.display = "block";

      Parse.Cloud.run('StravaTempActivities', {
        Accesstoken: result.username,
      }, {
        success: function(result) {
          var distances = [];
          for(j = 0; j<4; j++){
            var result1 = result[j].data;
            for (i = 0; i < result1.length; i++){
              if(result1[i].type == "Run"){
                var resultsloop = result1[i].distance;
                distances.push(resultsloop) 
              }
            }
          }
          var maxDistance = Math.max(...distances)
          document.getElementById('loading').style.display = "none";
          document.getElementById('connected').style.display = "block";
          updateUser(accessToken,"firstSweep",true);

        },
        error: function(error) {
          //Error function
        }
      });

    }

      
    var tops = result.tops
    for (i = 0; i < tops.length; i++){
      
      if(tops[i]){
          var topNumber = i+1
          var topNumberString =topNumber.toString();
          var element = document.getElementById("top"+topNumberString);
          element.classList.remove("disable");
          var element1 = document.getElementById("topUnlock"+topNumberString);
          element1.classList.remove("fa-lock");
          element1.classList.add("fa-check");
      }
    };

    var notifications = result.notifications

    if (notifications){
      document.getElementById('notifications1').style.display = "inline";
    }
    else{
      document.getElementById('notifications2').style.display = "inline";
    }

    var preferences = result.updates
    if (preferences){
      document.getElementById('preferences1').style.display = "inline";
    }
    else{
      document.getElementById('preferences2').style.display = "inline";
    }



  },
  error: function(error){ 
  document.getElementById('loading').style.display = "none";
  document.getElementById('connect').style.display = "flex";
  }
});
}


else if(accessTokenURL.length>0){

storeLocal('accessToken',accessTokenURL);

//var accessToken = accessTokenURL

startParse();
Parse.Cloud.run('retrieveUser', {
  AccessToken: accessTokenURL
  }, {
  success: function(result) {

    document.getElementById('loading').style.display = "none";
    document.getElementById('connected').style.display = "block";
    document.cookie = "accesstoken="+accessTokenURL+";max-age=2678400; path=/"
    document.getElementById("firstName").innerHTML = result.tokenResponse.athlete.firstname
    
    var tops = result.tops

    for (i = 0; i < tops.length; i++){
      
      if(tops[i]){
          var topNumber = i+1
          var topNumberString =topNumber.toString();
          var element = document.getElementById("top"+topNumberString);
          element.classList.remove("disable");
          var element1 = document.getElementById("topUnlock"+topNumberString);
          element1.classList.remove("fa-lock");
          element1.classList.add("fa-check");
      }
    };

    var notifications = result.notifications
    if (notifications){
      document.getElementById('notifications1').style.display = "inline";
    }
    else{
      document.getElementById('notifications2').style.display = "inline";
    }

    var preferences = result.updates
    if (preferences){
      document.getElementById('preferences1').style.display = "inline";
    }
    else{
      document.getElementById('preferences2').style.display = "inline";
    }

  },
  error: function(error){ 

  document.getElementById('loading').style.display = "none";
  document.getElementById('connect').style.display = "flex";

  }
});

}

else  {
  document.getElementById('loading').style.display = "none";
  document.getElementById('connect').style.display = "flex";
}


</script>
